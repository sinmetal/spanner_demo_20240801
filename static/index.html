<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Spanner Full Text Search Demo</title>
</head>
<script>
    function search() {
        const searchDiv = document.getElementById("search");
        const textareaValue = searchDiv.value;

        fetch('/api/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ text: textareaValue })
        })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = '';
                const searchMessage = document.createElement('p');
                searchMessage.textContent = searchDiv.value;
                resultDiv.appendChild(searchMessage);

                const newLine = document.createElement('p');
                newLine.textContent = "Search Done" + " : " + new Date();
                resultDiv.appendChild(newLine);

                if (data.results === null) {
                    const newLine = document.createElement('p');
                    newLine.textContent = "Empty search results";
                    resultDiv.appendChild(newLine);
                    return
                }

                data.results.forEach(item => {
                    const newLine = document.createElement('p');
                    newLine.textContent = item.createdAt + " : " + item.message;
                    resultDiv.appendChild(newLine);
                });
                searchDiv.value = "";
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function postMessage() {
        const postMessageDiv = document.getElementById("postMessage");
        const textareaValue = postMessageDiv.value;

        if (textareaValue === "") {
            return;
        }

        fetch('/api/postMessage', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ text: textareaValue })
        })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = '';
                const doneMessage = document.createElement('p');
                doneMessage.textContent = "Done Post Message" + " : " + new Date();
                resultDiv.appendChild(doneMessage);

                if (data.result === null) {
                    const newLine = document.createElement('p');
                    newLine.textContent = "Failed Post Data";
                    resultDiv.appendChild(newLine);
                    return;
                }

                const resultMessage = document.createElement('p');
                resultMessage.textContent = data.result.message;
                resultDiv.appendChild(resultMessage);
                postMessageDiv.value = "";
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
</script>
<body>
<h1>Spanner Full Text Search Demo</h1>
<section>
    <label for="postMessage">データ投入:</label>
    <textarea id="postMessage" name="post" rows="5" cols="100"></textarea>
    <button onclick="postMessage()">投入</button>
</section>
<section>
    <label for="search">データ検索:</label>
    <textarea id="search" name="search" rows="1" cols="100"></textarea>
    <button onclick="search()">検索</button>
</section>
<section>
    <div id="result"></div>
</section>

</body>
</html>